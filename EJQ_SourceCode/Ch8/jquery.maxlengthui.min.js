/* http://keith-wood.name/maxlengthui.html
   Maxlength plugin for jQuery UI v1.0.0.
   Written by Keith Wood (kbwood{at}iinet.com.au) March 2012.
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and 
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. 
   Please attribute the author if you use it. */
(function($){var f={options:{max:200,truncate:true,showFeedback:true,feedbackTarget:null,feedbackText:'{r} characters remaining ({m} maximum)',overflowText:'{o} characters too many ({m} maximum)',full:null},_feedbackClass:'-feedback',_fullClass:'ui-state-highlight',_overflowClass:'ui-state-error',_create:function(){this.feedbackTarget=$([]);var c=this;this.element.addClass(this.widgetFullName||this.widgetBaseClass).bind('keypress.'+this.widgetEventPrefix,function(a){if(!c.options.truncate){return true}var b=String.fromCharCode(a.charCode==undefined?a.keyCode:a.charCode);return(a.ctrlKey||a.metaKey||b=='\u0000'||$(this).val().length<c.options.max)}).bind('keyup.'+this.widgetEventPrefix,function(){c._checkLength($(this))});this.refresh()},_setOption:function(a,b){switch(a){case'disabled':this.element.prop('disabled',b);this.feedbackTarget.toggleClass('ui-state-disabled',b);break}if(this._superApply){this._superApply(arguments)}else{$.Widget.prototype._setOption.apply(this,arguments)}},_setOptions:function(a){if(this._superApply){this._superApply(arguments)}else{$.Widget.prototype._setOptions.apply(this,arguments)}this.refresh()},refresh:function(){if(this.feedbackTarget.length>0){if(this.hadFeedbackTarget){this.feedbackTarget.empty().val('').removeClass((this.widgetFullName||this.widgetBaseClass)+this._feedbackClass+' '+this._fullClass+' '+this._overflowClass)}else{this.feedbackTarget.remove()}this.feedbackTarget=$([])}if(this.options.showFeedback){this.hadFeedbackTarget=!!this.options.feedbackTarget;if($.isFunction(this.options.feedbackTarget)){this.feedbackTarget=this.options.feedbackTarget.apply(this.element[0],[])}else if(this.options.feedbackTarget){this.feedbackTarget=$(this.options.feedbackTarget)}else{this.feedbackTarget=$('<span></span>').insertAfter(this.element)}this.feedbackTarget.addClass((this.widgetFullName||this.widgetBaseClass)+this._feedbackClass+' ui-state-default'+(this.options.disabled?' ui-state-disabled':''))}this.element.unbind('mouseover.'+this.widgetEventPrefix+' focus.'+this.widgetEventPrefix+' mouseout.'+this.widgetEventPrefix+' blur.'+this.widgetEventPrefix);if(this.options.showFeedback=='active'){var a=this;this.element.bind('mouseover.'+this.widgetEventPrefix,function(){a.feedbackTarget.css('visibility','visible')}).bind('mouseout.'+this.widgetEventPrefix,function(){if(!a.focussed){a.feedbackTarget.css('visibility','hidden')}}).bind('focus.'+this.widgetEventPrefix,function(){a.focussed=true;a.feedbackTarget.css('visibility','visible')}).bind('blur.'+this.widgetEventPrefix,function(){a.focussed=false;a.feedbackTarget.css('visibility','hidden')});this.feedbackTarget.css('visibility','hidden')}this._checkLength()},curLength:function(){var a=this.element.val();var b=a.replace(/\r\n/g,'~~').replace(/\n/g,'~~').length;return{used:b,remaining:this.options.max-b}},_checkLength:function(){var a=this.element.val();var b=a.replace(/\r\n/g,'~~').replace(/\n/g,'~~').length;this.element.toggleClass(this._fullClass,b>=this.options.max).toggleClass(this._overflowClass,b>this.options.max);if(b>this.options.max&&this.options.truncate){var c=this.element.val().split(/\r\n|\n/);a='';var i=0;while(a.length<this.options.max&&i<c.length){a+=c[i].substring(0,this.options.max-a.length)+'\r\n';i++}this.element.val(a.substring(0,this.options.max));this.element[0].scrollTop=this.element[0].scrollHeight;b=this.options.max}this.feedbackTarget.toggleClass(this._fullClass,b>=this.options.max).toggleClass(this._overflowClass,b>this.options.max);var d=(b>this.options.max?this.options.overflowText:this.options.feedbackText).replace(/\{c\}/,b).replace(/\{m\}/,this.options.max).replace(/\{r\}/,this.options.max-b).replace(/\{o\}/,b-this.options.max);try{this.feedbackTarget.text(d)}catch(e){}try{this.feedbackTarget.val(d)}catch(e){}if(b>=this.options.max){this._trigger('full',null,$.extend(this.curLength(),{overflow:b>this.options.max}))}},_destroy:function(){if(this.feedbackTarget.length>0){if(this.hadFeedbackTarget){this.feedbackTarget.empty().val('').css('visibility','visible').removeClass((this.widgetFullName||this.widgetBaseClass)+this._feedbackClass+' '+this._fullClass+' '+this._overflowClass)}else{this.feedbackTarget.remove()}}this.element.removeClass((this.widgetFullName||this.widgetBaseClass)+' '+this._fullClass+' '+this._overflowClass).unbind('.'+this.widgetEventPrefix)}};if(!$.Widget.prototype._destroy){$.extend(f,{destroy:function(){this._destroy();$.Widget.prototype.destroy.call(this)}})}if($.Widget.prototype._getCreateOptions===$.noop){$.extend(f,{_getCreateOptions:function(){return $.metadata&&$.metadata.get(this.element[0])[this.widgetName]}})}$.widget('kbw.maxlength',f);$.kbw.maxlength.options=$.kbw.maxlength.prototype.options})(jQuery);